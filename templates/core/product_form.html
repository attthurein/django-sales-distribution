{% extends "base.html" %}
{% load widget_tweaks i18n %}

{% block breadcrumb %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'core:product_list' %}">{% trans "Products" %}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ title }}</li>
    </ol>
</nav>
{% endblock %}

{% block content %}
<h1>{{ title }}</h1>
<form method="post">
    {% csrf_token %}
    <div class="row">
        <div class="col-md-6">
            <h5>{% trans "Basic Info" %}</h5>
            <div class="mb-3">
                <label class="form-label" for="{{ form.name.id_for_label }}">{% trans "Name" %}</label>
                {{ form.name|add_class:"form-control" }}
                {% if form.name.errors %}<div class="text-danger">{{ form.name.errors }}</div>{% endif %}
            </div>
            <div class="mb-3">
                <label class="form-label" for="{{ form.description.id_for_label }}">{% trans "Description" %}</label>
                {{ form.description|add_class:"form-control" }}
            </div>
            <div class="mb-3">
                <label class="form-label" for="{{ form.sku.id_for_label }}">{% trans "SKU" %}</label>
                {{ form.sku|add_class:"form-control" }}
            </div>
            <div class="mb-3">
                <label class="form-label" for="{{ form.category.id_for_label }}">{% trans "Category" %}</label>
                {{ form.category|add_class:"form-select" }}
            </div>
            <div class="mb-3">
                <label class="form-label" for="{{ form.unit.id_for_label }}">{% trans "Unit" %}</label>
                {{ form.unit|add_class:"form-select" }}
            </div>
        </div>
        <div class="col-md-6">
            <h5>{% trans "Pricing & Stock" %}</h5>
            <div class="mb-3">
                <label class="form-label" for="{{ form.base_price.id_for_label }}">{% trans "Base Price" %}</label>
                {{ form.base_price|add_class:"form-control" }}
            </div>
            <div class="mb-3">
                <label class="form-label" for="{{ form.cost_price.id_for_label }}">{% trans "Cost Price" %}</label>
                {{ form.cost_price|add_class:"form-control" }}
            </div>
            <div class="mb-3">
                <label class="form-label" for="{{ form.stock_quantity.id_for_label }}">{% trans "Stock Quantity" %}</label>
                {{ form.stock_quantity|add_class:"form-control" }}
            </div>
            <div class="mb-3">
                <label class="form-label" for="{{ form.low_stock_threshold.id_for_label }}">{% trans "Low Stock Threshold" %}</label>
                {{ form.low_stock_threshold|add_class:"form-control" }}
            </div>
            <div class="mb-3">
                <label class="form-label" for="{{ form.expiry_date.id_for_label }}">{% trans "Expiry Date" %}</label>
                {{ form.expiry_date|add_class:"form-control" }}
            </div>
            <div class="mb-3">
                <label class="form-label" for="{{ form.expiry_alert_days.id_for_label }}">{% trans "Expiry Alert Days" %}</label>
                {{ form.expiry_alert_days|add_class:"form-control" }}
                <div class="form-text">{{ form.expiry_alert_days.help_text }}</div>
            </div>
            <div class="mb-3">
                <div class="form-check">
                    {{ form.is_active|add_class:"form-check-input" }}
                    <label class="form-check-label" for="{{ form.is_active.id_for_label }}">{% trans "Active" %}</label>
                </div>
            </div>
        </div>
    </div>

    <h5 class="mt-3">{% trans "Price Tiers (by Customer Type)" %}</h5>
    <p class="text-muted">{% trans "Override base price for specific customer types. Leave blank to use base price." %}</p>
    <div class="row mb-3">
        {% for field in form %}
        {% if "price_" in field.name %}
        <div class="col-md-4 mb-2">
            <label class="form-label">{{ field.label }}</label>
            {{ field|add_class:"form-control" }}
        </div>
        {% endif %}
        {% endfor %}
    </div>

    {% if form.non_field_errors %}<div class="alert alert-danger">{{ form.non_field_errors }}</div>{% endif %}
    <button type="submit" class="btn btn-primary">{% trans "Save" %}</button>
    {% if product %}
    <a href="{% url 'core:product_detail' product.pk %}" class="btn btn-secondary">{% trans "Cancel" %}</a>
    {% else %}
    <a href="{% url 'core:product_list' %}" class="btn btn-secondary">{% trans "Cancel" %}</a>
    {% endif %}
</form>
{% endblock %}
